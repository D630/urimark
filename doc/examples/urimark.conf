#!/usr/bin/env bash

# -- VARS.

editor=nano
description_default=null
hierarchy_default=null
name_default=null
reference_default=null
hook_default=um_default
tag_default=null

# -- HOOKS.

hook[list description]="Report: All as list and space as delimiter"
hook[list header]=
hook[list preprocess]=
hook[list filter]="uuid=."
hook[list postprocess]="| tr -d '\"' | tr '|' ' '"
hook[list footer]=

hook[llist description]="Report: All as list with labels and space as delimiter"
hook[llist header]=
hook[llist preprocess]="{ printf '%s\n' \"UUID|ID|BD|MD|SCHEME|AUTHORITY|PART|NAME|DESC|HIER|TAGS|REF\" ;"
hook[llist filter]="uuid=."
hook[llist postprocess]="; } | tr -d '\"' | tr '|' ' '"
hook[llist footer]=

hook[clist description]="Report: All with labels and formatted with column"
hook[clist header]=
hook[clist preprocess]="{ printf '%s\n' \"UUID|ID|BD|MD|SCHEME|AUTHORITY|PART|NAME|DESC|HIER|TAGS|REF\" ;"
hook[clist filter]="uuid=."
hook[clist postprocess]="; } | tr -d '\"' | column -s '|' -t"
hook[clist footer]=

hook[ifo description]="Report: All with line break"
hook[ifo header]=
hook[ifo preprocess]=
hook[ifo filter]="uuid=."
hook[ifo postprocess]="| tr '|' '\n' | tr -d '\"'"
hook[ifo footer]=

hook[ifol description]="Report: All with line break, labels and empty lines"
hook[ifol header]=
hook[ifol preprocess]="{ printf '%s\n' \"UUID|ID|BD|MD|SCHEME|AUTHORITY|PART|NAME|DESC|HIER|TAGS|REF\" "";"
hook[ifol filter]="uuid=."
hook[ifol postprocess]="; } | awk -F '|' '"'NR==1 {l=NF;for (i=1;i<=l;++i) head[i]=$i} NR>1 {for (i=1;i<=l;++i) print head[i] " " $i ; print ""}'"' | tr -d '\"'"
hook[ifol footer]=

hook[uri description]="Report: URI"
hook[uri header]=
hook[uri preprocess]=
hook[uri filter]="uuid=."
hook[uri postprocess]="| awk -F '|' '"'{print $5"://"$6$7}'"' | tr -d '\"'"
hook[uri footer]=

hook[browse description]="Interaction: Browse URI with urlview"
hook[browse header]=
hook[browse preprocess]=
hook[browse filter]="uuid=."
hook[browse postprocess]="| awk -F '|' '"'{print $5"://"$6$7}'"' | tr -d '\"' | urlview"
hook[browse footer]=

hook[iuri description]="Report: ID URI"
hook[iuri header]=
hook[iuri preprocess]=
hook[iuri filter]="uuid=."
hook[iuri postprocess]="| awk -F '|' '"'{print $2,$5"://"$6$7}'"' | tr -d '\"'"
hook[iuri footer]=

hook[it description]="Report: ID Tags"
hook[it header]=
hook[it preprocess]=
hook[it filter]="uuid=."
hook[it postprocess]="| cut -d '|' -f 2,11 --output-delimiter=' ' | tr -d '\"'"
hook[it footer]=

hook[abso description]="Report: Absolute Path"
hook[abso header]=
hook[abso preprocess]=
hook[abso filter]="uuid=."
hook[abso postprocess]="| awk -F '|' -v dir="$URIMARK_DATA_DIR" '"'{print dir"/"$2}'"' | tr -d '\"'"
hook[abso footer]=

hook[newest description]="Report: Last 10 newest records: ID,BD,URI"
hook[newest header]=
hook[newest preprocess]=
hook[newest filter]="uuid=."
hook[newest postprocess]="| awk -F '|' '"'{print $2,$3,$5"://"$6$7}'"' | tr -d '\"' | sort -k2 -n | tail -n 10"
hook[newest footer]=

hook[oldest description]="Report: Last 10 oldest records: ID,BD,URI"
hook[oldest header]=
hook[oldest preprocess]=
hook[oldest filter]="uuid=."
hook[oldest postprocess]="| awk -F '|' '"'{print $2,$3,$5"://"$6$7}'"' | tr -d '\"' | sort -k2 -n | head -n 10"
hook[oldest footer]=

hook[lmod description]="Last 10 modified records: ID,MD,URI"
hook[lmod header]=
hook[lmod preprocess]=
hook[lmod filter]="uuid=."
hook[lmod postprocess]="| awk -F '|' '"'{print $2,$4,$5"://"$6$7}'"' | tr -d '\"' | sort -k2 -n | tail -n 10"
hook[lmod footer]=

hook[number description]="Report: Number of Authorities and IDs"
hook[number header]=
hook[number preprocess]=
hook[number filter]="uuid=."
hook[number postprocess]="| tee >(wc -l) >(cut -d '|' -f 1 | sort | uniq | wc -l) >/dev/null"
hook[number footer]=

hook[scloud description]="Report: Cloud of schemes"
hook[scloud header]=
hook[scloud preprocess]=
hook[scloud filter]="uuid=."
hook[scloud postprocess]="| __um_hook_cloud 5"
hook[scloud footer]=

hook[acloud description]="Report: Cloud of authorities"
hook[acloud header]=
hook[acloud preprocess]=
hook[acloud filter]="uuid=."
hook[acloud postprocess]="| __um_hook_cloud 6"
hook[acloud footer]=

hook[hcloud description]="Report: Cloud of hierarchies"
hook[hcloud header]=
hook[hcloud preprocess]=
hook[hcloud filter]="uuid=."
hook[hcloud postprocess]="| __um_hook_cloud 10"
hook[hcloud footer]=

hook[tcloud description]="Report: Cloud of tags"
hook[tcloud header]=
hook[tcloud preprocess]=
hook[tcloud filter]="uuid=."
hook[tcloud postprocess]="| __um_hook_cloud 11"
hook[tcloud footer]=

hook[rcloud description]="Report: Cloud of references"
hook[rcloud header]=
hook[rcloud preprocess]=
hook[rcloud filter]="uuid=."
hook[rcloud postprocess]="| __um_hook_cloud 12"
hook[rcloud footer]=

hook[pcloud description]="Report: Number of parts"
hook[pcloud header]=
hook[pcloud preprocess]=
hook[pcloud filter]="uuid=."
hook[pcloud postprocess]="| cut -d'|' -f 7 | tr -d '\"' | sort | uniq -c | sort -nr"
hook[pcloud footer]=

# -- FUNCTIONS.

__um_hook_cloud()
{
    cut -d'|' -f "$1" | sed 's/\"//g;s/;/\n/g' | sort | uniq -c | sort -nr
}
